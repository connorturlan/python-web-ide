(function(){"use strict";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const k=Symbol("Comlink.proxy"),L=Symbol("Comlink.endpoint"),z=Symbol("Comlink.releaseProxy"),S=Symbol("Comlink.finalizer"),g=Symbol("Comlink.thrown"),C=e=>typeof e=="object"&&e!==null||typeof e=="function",j={canHandle:e=>C(e)&&e[k],serialize(e){const{port1:t,port2:n}=new MessageChannel;return x(e,t),[n,[n]]},deserialize(e){return e.start(),W(e)}},D={canHandle:e=>C(e)&&g in e,serialize({value:e}){let t;return e instanceof Error?t={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:t={isError:!1,value:e},[t,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},A=new Map([["proxy",j],["throw",D]]);function H(e,t){for(const n of e)if(t===n||n==="*"||n instanceof RegExp&&n.test(t))return!0;return!1}function x(e,t=globalThis,n=["*"]){t.addEventListener("message",function a(o){if(!o||!o.data)return;if(!H(n,o.origin)){console.warn(`Invalid origin '${o.origin}' for comlink proxy`);return}const{id:i,type:s,path:c}=Object.assign({path:[]},o.data),f=(o.data.argumentList||[]).map(m);let r;try{const l=c.slice(0,-1).reduce((u,h)=>u[h],e),d=c.reduce((u,h)=>u[h],e);switch(s){case"GET":r=d;break;case"SET":l[c.slice(-1)[0]]=m(o.data.value),r=!0;break;case"APPLY":r=d.apply(l,f);break;case"CONSTRUCT":{const u=new d(...f);r=Y(u)}break;case"ENDPOINT":{const{port1:u,port2:h}=new MessageChannel;x(e,h),r=G(u,[u])}break;case"RELEASE":r=void 0;break;default:return}}catch(l){r={value:l,[g]:0}}Promise.resolve(r).catch(l=>({value:l,[g]:0})).then(l=>{const[d,u]=_(l);t.postMessage(Object.assign(Object.assign({},d),{id:i}),u),s==="RELEASE"&&(t.removeEventListener("message",a),N(t),S in e&&typeof e[S]=="function"&&e[S]())}).catch(l=>{const[d,u]=_({value:new TypeError("Unserializable return value"),[g]:0});t.postMessage(Object.assign(Object.assign({},d),{id:i}),u)})}),t.start&&t.start()}function V(e){return e.constructor.name==="MessagePort"}function N(e){V(e)&&e.close()}function W(e,t){return P(e,[],t)}function w(e){if(e)throw new Error("Proxy has been released and is not useable")}function R(e){return p(e,{type:"RELEASE"}).then(()=>{N(e)})}const b=new WeakMap,E="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{const t=(b.get(e)||0)-1;b.set(e,t),t===0&&R(e)});function I(e,t){const n=(b.get(t)||0)+1;b.set(t,n),E&&E.register(e,t,e)}function U(e){E&&E.unregister(e)}function P(e,t=[],n=function(){}){let a=!1;const o=new Proxy(n,{get(i,s){if(w(a),s===z)return()=>{U(o),R(e),a=!0};if(s==="then"){if(t.length===0)return{then:()=>o};const c=p(e,{type:"GET",path:t.map(f=>f.toString())}).then(m);return c.then.bind(c)}return P(e,[...t,s])},set(i,s,c){w(a);const[f,r]=_(c);return p(e,{type:"SET",path:[...t,s].map(l=>l.toString()),value:f},r).then(m)},apply(i,s,c){w(a);const f=t[t.length-1];if(f===L)return p(e,{type:"ENDPOINT"}).then(m);if(f==="bind")return P(e,t.slice(0,-1));const[r,l]=T(c);return p(e,{type:"APPLY",path:t.map(d=>d.toString()),argumentList:r},l).then(m)},construct(i,s){w(a);const[c,f]=T(s);return p(e,{type:"CONSTRUCT",path:t.map(r=>r.toString()),argumentList:c},f).then(m)}});return I(o,e),o}function B(e){return Array.prototype.concat.apply([],e)}function T(e){const t=e.map(_);return[t.map(n=>n[0]),B(t.map(n=>n[1]))]}const F=new WeakMap;function G(e,t){return F.set(e,t),e}function Y(e){return Object.assign(e,{[k]:!0})}function _(e){for(const[t,n]of A)if(n.canHandle(e)){const[a,o]=n.serialize(e);return[{type:"HANDLER",name:t,value:a},o]}return[{type:"RAW",value:e},F.get(e)||[]]}function m(e){switch(e.type){case"HANDLER":return A.get(e.name).deserialize(e.value);case"RAW":return e.value}}function p(e,t,n){return new Promise(a=>{const o=q();e.addEventListener("message",function i(s){!s.data||!s.data.id||s.data.id!==o||(e.removeEventListener("message",i),a(s.data))}),e.start&&e.start(),e.postMessage(Object.assign({id:o},t),n)})}function q(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var M=function(e,t,n,a){function o(i){return i instanceof n?i:new n(function(s){s(i)})}return new(n||(n=Promise))(function(i,s){function c(l){try{r(a.next(l))}catch(d){s(d)}}function f(l){try{r(a.throw(l))}catch(d){s(d)}}function r(l){l.done?i(l.value):o(l.value).then(c,f)}r((a=a.apply(e,t||[])).next())})},O=function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},a,o,i,s;return s={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function c(r){return function(l){return f([r,l])}}function f(r){if(a)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(n=0)),n;)try{if(a=1,o&&(i=r[0]&2?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[r[0]&2,i.value]),r[0]){case 0:case 1:i=r;break;case 4:return n.label++,{value:r[1],done:!1};case 5:n.label++,o=r[1],r=[0];continue;case 7:r=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(r[0]===6||r[0]===2)){n=0;continue}if(r[0]===3&&(!i||r[1]>i[0]&&r[1]<i[3])){n.label=r[1];break}if(r[0]===6&&n.label<i[1]){n.label=i[1],i=r;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(r);break}i[2]&&n.ops.pop(),n.trys.pop();continue}r=t.call(e,n)}catch(l){r=[6,l],o=0}finally{a=i=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},X=function(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],a=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},$=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var a=n.call(e),o,i=[],s;try{for(;(t===void 0||t-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(c){s={error:c}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(s)throw s.error}}return i};importScripts("https://cdn.jsdelivr.net/pyodide/v0.22.0/full/pyodide.js"),console.log=function(){};var J=`
import sys
from pyodide.ffi import to_js
from pyodide.console import PyodideConsole, repr_shorten, BANNER
import __main__
BANNER = "Welcome to the Pyodide terminal emulator ðŸ\\n" + BANNER
pyconsole = PyodideConsole(__main__.__dict__)
import builtins
async def await_fut(fut):
  res = await fut
  if res is not None:
    builtins._ = res
  return to_js([res], depth=1)
def clear_console():
  pyconsole.buffer = []
`,v,K={init:function(e,t,n){return M(this,void 0,void 0,function(){var a,o,i,s,c,f,r,l,d;return O(this,function(u){switch(u.label){case 0:return a=self,[4,self.loadPyodide({})];case 1:return a.pyodide=u.sent(),n[0].length>0?[4,self.pyodide.loadPackage(n[0])]:[3,3];case 2:u.sent(),u.label=3;case 3:return n[1].length>0?[4,self.pyodide.loadPackage(["micropip"])]:[3,6];case 4:return u.sent(),o=self.pyodide.pyimport("micropip"),[4,o.install(n[1])];case 5:u.sent(),u.label=6;case 6:return i=self.pyodide.version,s=self.pyodide.globals.get("dict")(),[4,self.pyodide.runPythonAsync(J,{globals:s})];case 7:return u.sent(),c=s.get("repr_shorten"),f=s.get("BANNER"),r=s.get("await_fut"),l=s.get("pyconsole"),d=s.get("clear_console"),s.destroy(),l.stdout_callback=e,v={reprShorten:c,awaitFut:r,pyconsole:l,clearConsole:d},t({version:i,banner:f}),[2]}})})},run:function(e){return M(this,void 0,void 0,function(){var t,n,a,o,i,s,c,f,r,l,d,u,h;return O(this,function(y){switch(y.label){case 0:if(!v)throw new Error("Console has not been initialised");if(e===void 0)throw new Error("No code to push");y.label=1;case 1:y.trys.push([1,9,10,11]),n=X(e.split(`
`)),a=n.next(),y.label=2;case 2:if(a.done)return[3,8];o=a.value,i=v.pyconsole.push(o),t=i.syntax_check,s=v.awaitFut(i),y.label=3;case 3:return y.trys.push([3,5,6,7]),[4,s];case 4:return c=$.apply(void 0,[y.sent(),1]),f=c[0],self.pyodide.isPyProxy(f)&&f.destroy(),[3,7];case 5:if(r=y.sent(),r.constructor.name==="PythonError")return l=i.formatted_error||r.message,[2,{state:t,error:l.trimEnd()}];throw r;case 6:return i.destroy(),s.destroy(),[7];case 7:return a=n.next(),[3,2];case 8:return[3,11];case 9:return d=y.sent(),u={error:d},[3,11];case 10:try{a&&!a.done&&(h=n.return)&&h.call(n)}finally{if(u)throw u.error}return[7];case 11:return[2,{state:t}]}})})},readFile:function(e){return self.pyodide.FS.readFile(e,{encoding:"utf8"})},writeFile:function(e,t){return self.pyodide.FS.writeFile(e,t,{encoding:"utf8"})},mkdir:function(e){self.pyodide.FS.mkdir(e)},rmdir:function(e){self.pyodide.FS.rmdir(e)}};x(K)})();
